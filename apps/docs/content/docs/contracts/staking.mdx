---
title: MOR Staking
description: Stake MOR tokens using Builders V4 subnet infrastructure
---

# MOR Staking

Morpheus enables staking MOR tokens on Base network using **Builders V4**, a subnet-based staking infrastructure. A portion of deployment funds is automatically staked to MOR, contributing to the Morpheus Deploy infrastructure subnet.

## Overview

The staking system uses Builders V4:

- **Subnet-Based** - Deposits go to the Morpheus Deploy subnet
- **Direct 1:1 Deposits** - No share conversion, direct MOR deposits
- **Auto-stake** - 60% of deployment funds go to MOR staking
- **Lock Period** - Configurable withdrawal lock period per subnet
- **Production-Ready** - Audited contract system already deployed on Base

<Callout type="info">
  **Builders V4** is a proven, audited staking infrastructure already deployed on Base Mainnet and Base Sepolia. Unlike traditional share-based systems, it uses a subnet architecture where each project has an isolated staking pool.
</Callout>

## Architecture

```
┌──────────────────────────────────────────────────────────────────┐
│                         User                                      │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                 Smart Wallet (USDC)                          │ │
│  │  ┌──────────────────────────────────────────────────────┐   │ │
│  │  │  USDC Balance ──┬──▶ 40% → AKT (Deployment)          │   │ │
│  │  │                 └──▶ 60% → MOR (Staking)             │   │ │
│  │  └──────────────────────────────────────────────────────┘   │ │
│  └─────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────────┐
│              Builders V4 Registry Contract                       │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  Subnet: "Morpheus Deploy"                                   │ │
│  │  ┌────────────────┐  ┌────────────────┐  ┌──────────────┐   │ │
│  │  │ User Deposits  │  │  Lock Period   │  │   Subnet     │   │ │
│  │  │   (1:1 MOR)    │  │ Configuration  │  │    Admin     │   │ │
│  │  └────────────────┘  └────────────────┘  └──────────────┘   │ │
│  └─────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘
```

## Installation

```typescript
import { MorpheusStaking } from '@morpheus-deploy/contracts';
```

## Connecting

```typescript
const staking = new MorpheusStaking(
  {
    network: 'testnet', // or 'mainnet'
    rpcUrl: 'https://sepolia.base.org', // optional override
  },
  privateKey
);
```

## Staking Operations

### Stake MOR

```typescript
const amount = 100n * 10n ** 18n; // 100 MOR (18 decimals)

const result = await staking.stake(amount);

console.log(result);
// {
//   txHash: '0xabc123...',
//   shares: 100000000000000000000n,    // Amount deposited (1:1)
//   morphAmount: 100000000000000000000n // MOR staked
// }
```

<Callout>
  The stake function automatically approves the staking contract if needed. You don't need to call approve separately.
</Callout>

<Callout type="warn">
  In Builders V4, deposits are **1:1** with MOR tokens. The `shares` field in `StakeResult` contains the deposited amount for backward compatibility, but there is no share conversion.
</Callout>

### Unstake MOR

```typescript
// Unstake by amount (not shares)
const amount = 50n * 10n ** 18n; // 50 MOR
const txHash = await staking.unstake(amount);

console.log(`Unstaked 50 MOR: ${txHash}`);
```

<Callout type="warn">
  Withdrawals may be subject to a lock period configured by the subnet. Check your position's `lockedUntil` field before attempting to unstake.
</Callout>

## Reading Positions

### Your Position

```typescript
const position = await staking.getPosition(walletAddress);

console.log(position);
// {
//   amount: 100000000000000000000n,    // 100 MOR deposited
//   shares: 100000000000000000000n,    // Same as amount (1:1)
//   rewards: 0n,                       // Not tracked in Builders V4
//   lockedUntil: Date('2024-03-15')    // Withdrawal lock expiry
// }
```

<Callout type="info">
  **Note**: The `rewards` field is always `0n` in Builders V4. Rewards are managed externally by the subnet admin or through separate mechanisms.
</Callout>

### Protocol Stats

```typescript
// Total staked in the Morpheus Deploy subnet
const totalStaked = await staking.getTotalStaked();
console.log(`Total staked: ${totalStaked / 10n ** 18n} MOR`);
```

## API Reference

### StakeConfig

```typescript
interface StakeConfig {
  network: 'mainnet' | 'testnet';
  rpcUrl?: string;
}
```

### StakePosition

```typescript
interface StakePosition {
  amount: bigint;     // MOR deposited to subnet
  shares: bigint;     // Same as amount (1:1, for compatibility)
  rewards: bigint;    // Always 0n in Builders V4
  lockedUntil: Date;  // Withdrawal lock expiration
}
```

### StakeResult

```typescript
interface StakeResult {
  txHash: string;
  shares: bigint;      // Deposited amount (1:1, for compatibility)
  morphAmount: bigint; // MOR deposited
}
```

### Methods

| Method                 | Description                                          |
| ---------------------- | ---------------------------------------------------- |
| `stake(amount)`        | Deposit MOR tokens to Morpheus Deploy subnet        |
| `unstake(amount)`      | Withdraw MOR from subnet (subject to lock period)    |
| `getPosition(address)` | Get staking position for address                     |
| `getTotalStaked()`     | Total MOR deposited in Morpheus Deploy subnet        |
| `sharesToMOR(amount)`  | Returns same value (1:1, for compatibility)          |

### Deprecated Methods

| Method           | Status      | Reason                                              |
| ---------------- | ----------- | --------------------------------------------------- |
| `claimRewards()` | **Removed** | Builders V4 doesn't support direct reward claiming  |
| `getAPY()`       | **Removed** | APY must be calculated externally                   |

<Callout type="error">
  Calling `claimRewards()` or `getAPY()` will throw an error. These features are not available in Builders V4 and must be implemented externally if needed.
</Callout>

## Contract Addresses

### Base Sepolia (Testnet)

| Component                | Address                                              |
| ------------------------ | ---------------------------------------------------- |
| Builders V4 Registry     | `0x6C3401D71CEd4b4fEFD1033EA5F83e9B3E7e4381`         |
| Subnet ID                | `0xab4d64309bda15052e3e9133923a6b3d3b617bea4ab70a8d1bbebb3e94c1bf22` |
| MOR Token                | `0x5c80ddd187054e1e4abbffcd750498e81d34ffa3`         |

### Base Mainnet

| Component                | Address                                              |
| ------------------------ | ---------------------------------------------------- |
| Builders V4 Registry     | `0x42bb446eae6dca7723a9ebdb81ea88afe77ef4b9`         |
| Subnet ID                | `0x0000000000000000000000000000000000000000000000000000000000000000` (TBD) |
| MOR Token                | TBD                                                  |

<Callout type="warn">
  Mainnet subnet ID is not yet configured. Only testnet (Base Sepolia) is currently available.
</Callout>

## Integration with Deployment Flow

### Automatic Staking (Default)

When you fund a deployment, Morpheus automatically splits funds:

```yaml
# morpheus.yaml
funding:
  source: smart-wallet
  currency: USDC
  initialDeposit: 100.00
  staking:
    enabled: true # Default: true
    percentage: 60 # Default: 60%
```

**Flow:**

1. $100 USDC deposited
2. $40 → Swapped to AKT for deployment
3. $60 → Swapped to MOR and deposited to Morpheus Deploy subnet

### Manual Staking

Disable auto-staking and manage manually:

```yaml
funding:
  staking:
    enabled: false
```

```typescript
// Manually stake via SDK
const staking = new MorpheusStaking({ network: 'testnet' }, privateKey);
await staking.stake(amount);
```

## Lock Periods

Staked tokens are subject to withdrawal lock periods configured by the subnet:

```typescript
const position = await staking.getPosition(address);

if (position.lockedUntil > new Date()) {
  const lockTimeRemaining = position.lockedUntil.getTime() - Date.now();
  const daysLocked = Math.ceil(lockTimeRemaining / (1000 * 60 * 60 * 24));
  console.log(`Locked for ${daysLocked} more days`);
  console.log('Cannot unstake yet');
} else {
  // Safe to unstake
  await staking.unstake(position.amount);
}
```

## Migration from Previous System

### What Changed

If you're familiar with share-based staking systems, here are the key differences in Builders V4:

| Aspect     | Traditional Staking | Builders V4 (Current)                         |
| ---------- | ------------------- | --------------------------------------------- |
| Deposits   | Share-based         | Direct 1:1 MOR deposits                       |
| Rewards    | Built-in tracking   | Managed externally by subnet admin            |
| APY        | Contract provides   | Must be calculated externally                 |
| Claiming   | `claimRewards()`    | Not available                                 |
| Unstaking  | By shares           | By amount (1:1)                               |
| Subnet     | N/A                 | Isolated per-project pool                     |

### API Compatibility

The `MorpheusStaking` class maintains backward compatibility:

```typescript
// These still work
await staking.stake(amount);
await staking.unstake(amount);
const position = await staking.getPosition(address);
const total = await staking.getTotalStaked();

// These throw errors (not available in Builders V4)
await staking.claimRewards(); // ❌ Error
const apy = await staking.getAPY(); // ❌ Error
```

## Error Handling

### Common Errors

```typescript
try {
  await staking.stake(amount);
} catch (error) {
  if (error.message.includes('insufficient balance')) {
    console.log('Not enough MOR tokens');
  } else if (error.message.includes('allowance')) {
    console.log('Token approval failed');
  } else if (error.message.includes('minimal deposit')) {
    console.log('Amount below subnet minimum deposit');
  }
}

try {
  await staking.unstake(amount);
} catch (error) {
  if (error.message.includes('insufficient deposit')) {
    console.log('Trying to withdraw more than deposited');
  } else if (error.message.includes('lock')) {
    console.log('Tokens are still locked');
  }
}
```

### Checking Before Operations

```typescript
// Check MOR balance before staking
const morBalance = await getMORBalance(address);
if (morBalance < amount) {
  throw new Error(`Insufficient MOR: have ${morBalance}, need ${amount}`);
}

// Check lock before unstaking
const position = await staking.getPosition(address);
if (position.lockedUntil > new Date()) {
  throw new Error(`Tokens locked until ${position.lockedUntil}`);
}

// Check available balance
if (position.amount < amount) {
  throw new Error(`Insufficient deposit: have ${position.amount}, need ${amount}`);
}
```

## Advanced Topics

### Understanding Subnet Architecture

Builders V4 uses a subnet model where each project has an isolated staking pool:

- **Subnet ID**: 32-byte identifier for the Morpheus Deploy subnet
- **Subnet Config**: Lock periods, minimum deposits, admin address
- **Isolated Pools**: Each subnet's deposits are separate
- **Subnet Admin**: Can configure parameters and manage the subnet

```typescript
// All operations are scoped to the Morpheus Deploy subnet
// The subnet ID is automatically included in all contract calls
await staking.stake(amount); // → deposit(MORPHEUS_SUBNET_ID, amount)
```

### Direct Contract Interaction

For advanced users who want to bypass the SDK:

```typescript
import { createWalletClient, http } from 'viem';
import { baseSepolia } from 'viem/chains';
import { STAKING_ABI, STAKING_ADDRESS, SUBNET_ID } from '@morpheus-deploy/contracts/staking/abi';

const client = createWalletClient({
  chain: baseSepolia,
  transport: http(),
});

// Direct deposit
await client.writeContract({
  address: STAKING_ADDRESS.testnet,
  abi: STAKING_ABI,
  functionName: 'deposit',
  args: [SUBNET_ID.testnet, amount],
});

// Check user deposit
const deposit = await client.readContract({
  address: STAKING_ADDRESS.testnet,
  abi: STAKING_ABI,
  functionName: 'getUserDeposit',
  args: [SUBNET_ID.testnet, userAddress],
});
```

## References

- [Builders V4 on Base Sepolia](https://sepolia.basescan.org/address/0x6C3401D71CEd4b4fEFD1033EA5F83e9B3E7e4381)
- [Subnet Creation Transaction](https://sepolia.basescan.org/tx/0xe10bc2b48e024bac539f303a020abb68f34a8f4ab57cd8b68edf258cc70e366d)
- [Example Deposit Transaction](https://sepolia.basescan.org/tx/0xaafea377f2f8cddc4778fc9305aaca0489aab5360aa2b29db60646e4374b73cc)
- [Migration Documentation](/docs/STAKING_BUILDERS_V4.md)
